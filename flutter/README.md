# Flutter bindings

This folder holds the Dart bindings generated by Flutter Rust Bridge (FRB) plus a small wrapper that constructs a `G2pModelConfig` from a Flutter-provided asset root.

## Codegen

FRB reads the Rust API from `crate::api` in `rust/g2p_ffi` and writes Dart outputs to `flutter/lib/src/` using `flutter/flutter_rust_bridge.yaml`.

```bash
flutter_rust_bridge_codegen generate --config-file flutter/flutter_rust_bridge.yaml
```

Notes:
- FRB requires the Dart/Flutter toolchain on your machine to run codegen.
- `tvm-ffi-config` must be on `PATH` (e.g., `python/.pixi/envs/default/bin`) because FRB runs `cargo expand` on the Rust crate during codegen.

## Minimal usage

```dart
import 'package:charsiug2p_flutter/charsiug2p_flutter.dart';

Future<void> runG2p() async {
  // assetRoot should contain tokenizers/ and tvm/ subfolders.
  final assetRoot = await CharsiuG2pAssets.prepareTokenizerRoot(
    assetPrefix: 'assets/charsiug2p',
  );

  await CharsiuG2p.init();
  final g2p = await CharsiuG2p.load(assetRoot: assetRoot);
  final phones = await g2p.run(['Char', 'siu'], 'eng-us');
  print(phones);
}
```

Platform paths:
- Use `CharsiuG2pPlatformChannels.getPaths()` to get platform-specific bundle paths.
- On iOS, `resourceDir` points to the app bundle resources.
- On Android, `nativeLibraryDir` points to the APK native libs directory.

## Example app

The example Flutter app lives under `flutter/example/`. Run it with:

```bash
cd flutter/example
flutter pub get
flutter run
```

Asset placement:
- Place tokenizer assets under `<assetRoot>/tokenizers/<checkpoint_sanitized>/in{max_input_bytes}_out{max_output_len}/`.
- Place TVM artifacts under `<assetRoot>/tvm/<checkpoint_sanitized>/b{batch_size}_in{max_input_bytes}_out{max_output_len}/metal-ios/` (iOS) or the matching target name for other platforms.
