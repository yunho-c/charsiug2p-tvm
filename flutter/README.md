# Flutter bindings

This folder holds the Dart bindings generated by Flutter Rust Bridge (FRB) plus a small wrapper that constructs a `G2pModelConfig` from a Flutter-provided asset root.

## Codegen

FRB reads the Rust API from `crate::api` in `flutter/rust` and writes Dart outputs to `flutter/lib/src/` using `flutter/flutter_rust_bridge.yaml`.

```bash
flutter_rust_bridge_codegen generate --config-file flutter/flutter_rust_bridge.yaml
```

Notes:
- FRB requires the Dart/Flutter toolchain on your machine to run codegen.
- `tvm-ffi-config` must be on `PATH` (e.g., `python/.pixi/envs/default/bin`) because FRB runs `cargo expand` on the Rust crate during codegen.

Build integration:
- The Rust crate lives at `flutter/rust` and is built via Cargokit (`flutter/cargokit`) during platform builds.
- On Apple platforms, the Rust static library is linked into the plugin; `CharsiuG2p.init()` defaults to `ExternalLibrary.process()` there.

## Minimal usage

```dart
import 'package:charsiug2p_flutter/charsiug2p_flutter.dart';

Future<void> runG2p() async {
  // assetRoot should contain tokenizers/ and tvm/ subfolders.
  final assetRoot = await CharsiuG2pAssets.prepareTokenizerRoot(
    assetPrefix: 'assets/charsiug2p',
  );
  final tvmRoot = await CharsiuG2pAssets.resolveBundleTvmRoot(
    assetPrefix: 'assets/charsiug2p',
  );

  await CharsiuG2p.init();
  final g2p = await CharsiuG2p.load(
    assetRoot: assetRoot,
    tvmRoot: tvmRoot,
  );
  final phones = await g2p.run(['Char', 'siu'], 'eng-us');
  print(phones);
}
```

Platform paths:
- Use `CharsiuG2pPlatformChannels.getPaths()` to get platform-specific bundle paths.
- On iOS, `resourceDir` points to the app bundle resources.
- On Android, `nativeLibraryDir` points to the APK native libs directory.
- On macOS, `resourceDir` points to app bundle resources and `nativeLibraryDir` points to the app Frameworks directory.
- On Windows, `resourceDir` points to `data/flutter_assets` and `nativeLibraryDir` points to the executable directory.
- On Linux, `resourceDir` points to `data/flutter_assets` and `nativeLibraryDir` points to the bundle `lib` directory.
- On Web, both fields are `null`.


## Example app

The example Flutter app lives under `flutter/example/`. Run it with:

```bash
cd flutter/example
flutter pub get
flutter run
```

Asset placement:
- Place tokenizer assets under `<assetRoot>/tokenizers/<checkpoint_sanitized>/in{max_input_bytes}_out{max_output_len}/`.
- Place TVM artifacts under `<assetRoot>/tvm/<checkpoint_sanitized>/b{batch_size}_in{max_input_bytes}_out{max_output_len}/metal-ios/` (iOS) or the matching target name for other platforms.
